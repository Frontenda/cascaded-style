// Generated by CoffeeScript 1.4.0
(function() {
  var COMPOSITES, _compositeProperty, _filterProperties, _inspect, _inspectCSS, _replaceInherit, _sortBySpecificity;

  $.fn.cascadedStyle = function(options) {
    return _inspectCSS($(this), options);
  };

  _inspectCSS = function(el, options) {
    var func;
    if (options == null) {
      options = {};
    }
    func = window.getMatchedCSSRules;
    if (!(func && !options.polyfill)) {
      func = window.getMatchedCSSRulesPolyfill;
    }
    options["function"] = func;
    return _inspect(el, options);
  };

  window.getMatchedCSSRulesPolyfill = function(element) {
    var fn, result, rule, sheet, sheetMedia, styleSheets, _i, _len, _ref;
    if (!element) {
      return [];
    }
    result = [];
    styleSheets = Array.prototype.slice.call(document.styleSheets);
    while (sheet = styleSheets.shift()) {
      sheetMedia = sheet.media.mediaText;
      if (sheet.disabled || !sheet.cssRules) {
        continue;
      }
      if (sheetMedia.length && (!window.matchMedia || !window.matchMedia(sheetMedia).matches)) {
        continue;
      }
      _ref = sheet.cssRules;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        rule = _ref[_i];
        if (rule.stylesheet) {
          styleSheets.push(rule.stylesheet);
          continue;
        } else if (rule.media) {
          styleSheets.push(rule);
          continue;
        }
        fn = element.matchesSelector || element.mozMatchesSelector || element.webkitMatchesSelector;
        try {
          if (fn.call(element, rule.selectorText)) {
            result.push(rule);
          }
        } catch (e) {

        }
      }
    }
    return result;
  };

  _sortBySpecificity = function(rules, element) {
    var cmp, getSpec, spec,
      _this = this;
    spec = {};
    getSpec = function(rule) {
      if (spec[rule.selectorText] == null) {
        spec[rule.selectorText] = $.specificity(rule.selectorText, {
          element: element
        });
      }
      return spec[rule.selectorText];
    };
    cmp = function(a, b) {
      return getSpec(a) - getSpec(b);
    };
    rules.sort(cmp);
    return rules;
  };

  _inspect = function(element, options) {
    var important, isImportant, matchedRule, matchedRules, property, results, style, value, _i, _j, _len, _len1;
    if (options == null) {
      options = {};
    }
    if (!options["function"]) {
      options["function"] = window.getMatchedCSSRules;
    }
    if (element instanceof jQuery) {
      element = element[0];
    }
    results = {};
    important = {};
    matchedRules = options["function"].call(window, element, null);
    matchedRules = Array.prototype.slice.call(matchedRules);
    _sortBySpecificity(matchedRules, element);
    matchedRules.push(element);
    matchedRules.reverse();
    for (_i = 0, _len = matchedRules.length; _i < _len; _i++) {
      matchedRule = matchedRules[_i];
      style = matchedRule.style;
      for (_j = 0, _len1 = style.length; _j < _len1; _j++) {
        property = style[_j];
        isImportant = style.getPropertyPriority(property);
        value = style.getPropertyValue(property);
        if (!(results[property] != null) && value && value !== 'initial') {
          results[property] = value;
        } else if (value && isImportant && !important[property]) {
          results[property] = value;
          important[property] = true;
        }
      }
    }
    if (options.replaceInherit) {
      results = _replaceInherit(element, results);
    }
    if (options.properties) {
      results = _filterProperties(element, results, options.properties);
    }
    return results;
  };

  _filterProperties = function(el, css, properties) {
    var computeStyle, prop, results, style, _i, _len;
    if (!(properties && properties.length)) {
      return css;
    }
    style = $(el).computedStyle();
    computeStyle = function(property) {
      var value;
      value = _compositeProperty(property, css);
      if (value == null) {
        value = style[property];
      }
      return value;
    };
    results = {};
    for (_i = 0, _len = properties.length; _i < _len; _i++) {
      prop = properties[_i];
      results[prop] = prop in css ? css[prop] : computeStyle(prop);
    }
    return results;
  };

  _replaceInherit = function(el, css) {
    var prop, style, value;
    style = $(el).computedStyle();
    for (prop in css) {
      value = css[prop];
      if ((value != null) && (value.indexOf('inherit') === 0 || value.indexOf('initial') > -1)) {
        css[prop] = style[prop];
      }
    }
    return css;
  };

  _compositeProperty = function(property, css) {
    if (COMPOSITES[property]) {
      return COMPOSITES[property](css);
    }
    return null;
  };

  COMPOSITES = {
    'background-position': function(css) {
      if (css['background-position-x'] && css['background-position-y']) {
        return "" + css['background-position-x'] + " " + css['background-position-y'];
      }
      return null;
    }
  };

}).call(this);
